/**
 * @name please-define.js
 * @version 1.0.0
 * @update Feb 24, 2017
 * @website https://github.com/earthchie/please-define.js
 * @author Earthchie http://www.earthchie.com/
 * @license WTFPL v.2 - http://www.wtfpl.net/
 **/
window.PleaseDefine=window.PleaseDefine||function(SELECT,OPTIONS){'use strict';OPTIONS=OPTIONS||{};OPTIONS.placeholder=OPTIONS.placeholder||'Other, please define.';OPTIONS.required=OPTIONS.required||SELECT.getAttribute('required')==='';OPTIONS.label_empty=OPTIONS.label_empty||'- Please Choose -';var val=SELECT.value,option_list=SELECT.getElementsByTagName('option'),mask=document.createElement('div'),mask_options='',label=OPTIONS.label_empty,i,span,input,triggerOnChange=function(){if(document.createEvent===undefined){SELECT.fireEvent('onchange')}else{var evt=document.createEvent('HTMLEvents');evt.initEvent('change',!1,!0);SELECT.dispatchEvent(evt)}},insertAfter=function(newNode,referenceNode){referenceNode.parentNode.insertBefore(newNode,referenceNode.nextSibling)},getOffset=function(el){var rect=el.getBoundingClientRect();return{top:rect.top+document.body.scrollTop,left:rect.left+document.body.scrollLeft}},setClass=function(mask,className,isActive){var classes=mask.getAttribute('class').split(' '),indexOfActive=classes.indexOf(className);delete classes[indexOfActive];if(isActive==='toggle'){if(indexOfActive>-1){setClass(mask,className,!1)}else{setClass(mask,className,!0)}}else{if(isActive===!0){classes.push(className)}
mask.setAttribute('class',classes.join(' '))}},setActive=function(mask,isActive){var belowSpace=document.body.offsetHeight-getOffset(mask).top-mask.offsetHeight;setClass(mask,'active',isActive);setTimeout(function(){var mask_height=mask.getElementsByTagName('ul')[0].offsetHeight;setClass(mask,'flip',belowSpace<mask_height)},10)},optionOnClick=function(option){option.onclick=function(){SELECT.value=this.getAttribute('data-value');span.innerHTML=this.innerHTML;input.value='';setActive(mask,!1);triggerOnChange()}};for(i=0;i<option_list.length;i=i+1){if(option_list[i].value){mask_options+='<li data-value="'+option_list[i].value+'">'+option_list[i].innerHTML+'</li>'}}
mask_options+='<li><input type="text" placeholder="'+OPTIONS.placeholder+'"></li>';mask.setAttribute('class','please-define');label=SELECT.querySelector('[value="'+SELECT.value+'"]');if(label===null){label=OPTIONS.label_empty}else{label=label.innerHTML}
mask.innerHTML='<span>'+label+'</span><ul>'+mask_options+'</ul>';insertAfter(mask,SELECT);SELECT.style.display='none';SELECT.appendChild(document.createElement('option'));span=mask.getElementsByTagName('span')[0];mask_options=mask.getElementsByTagName('li');input=mask.getElementsByTagName('input')[0];SELECT.val=function(val){if(val){if(val!==''||OPTIONS.required===!1){var options=SELECT.getElementsByTagName('option');options[options.length-1].value=val;SELECT.value=val;span.innerHTML=val||OPTIONS.label_empty;triggerOnChange()}else{if(SELECT.value===SELECT.querySelector('option:last-child').value){this.value=SELECT.value}}}else{return SELECT.value}};window.onclick=function(){var activeMask=document.querySelector('.please-define.active');if(activeMask!==null){setActive(activeMask,!1)}};mask.onclick=function(e){e.stopPropagation();var activeMask=document.querySelectorAll('.please-define.active');for(i=0;i<activeMask.length;i=i+1){if(activeMask[i]!==mask){setActive(activeMask[i],!1)}}};span.onclick=function(e){setActive(mask,'toggle')};for(i=0;i<mask_options.length-1;i=i+1){optionOnClick(mask_options[i])}
input.onkeyup=function(e){var val=this.value,keyCode=e.keyCode||e.which,options=SELECT.getElementsByTagName('option');if(typeof OPTIONS.filter==='function'){val=OPTIONS.filter(val)||val}
this.value=val;if(keyCode===13){setActive(mask,!1);SELECT.val(val);return!1}};return SELECT}