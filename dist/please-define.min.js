/**
 * @name please-define.js
 * @version 1.0.1
 * @update Feb 24, 2017
 * @website https://github.com/earthchie/please-define.js
 * @author Earthchie http://www.earthchie.com/
 * @license WTFPL v.2 - http://www.wtfpl.net/
 **/
window.PleaseDefine=window.PleaseDefine||function(a,b){"use strict";b=b||{},b.placeholder=b.placeholder||"Other, please define.",b.required=b.required||""===a.getAttribute("required"),b.label_empty=b.label_empty||"- Please Choose -";var h,i,j,d=(a.value,a.getElementsByTagName("option")),e=document.createElement("div"),f="",g=b.label_empty,k=function(){if(void 0===document.createEvent)a.fireEvent("onchange");else{var b=document.createEvent("HTMLEvents");b.initEvent("change",!1,!0),a.dispatchEvent(b)}},l=function(a,b){b.parentNode.insertBefore(a,b.nextSibling)},m=function(a){var b=a.getBoundingClientRect();return{top:b.top+document.body.scrollTop,left:b.left+document.body.scrollLeft}},n=function(a,b,c){var d=a.getAttribute("class").split(" "),e=d.indexOf(b);delete d[e],"toggle"===c?e>-1?n(a,b,!1):n(a,b,!0):(c===!0&&d.push(b),a.setAttribute("class",d.join(" ")))},o=function(a,b){var c=document.body.offsetHeight-m(a).top-a.offsetHeight;n(a,"active",b),setTimeout(function(){var b=a.getElementsByTagName("ul")[0].offsetHeight;n(a,"flip",c<b)},10)},p=function(b){b.onclick=function(){a.value=this.getAttribute("data-value"),i.innerHTML=this.innerHTML,j.value="",o(e,!1),k()}};for(h=0;h<d.length;h+=1)d[h].value&&(f+='<li data-value="'+d[h].value+'">'+d[h].innerHTML+"</li>");for(f+='<li><input type="text" placeholder="'+b.placeholder+'"></li>',e.setAttribute("class","please-define"),g=a.querySelector('[value="'+a.value+'"]'),g=null===g?b.label_empty:g.innerHTML,e.innerHTML="<span>"+g+"</span><ul>"+f+"</ul>",l(e,a),a.style.display="none",a.appendChild(document.createElement("option")),i=e.getElementsByTagName("span")[0],f=e.getElementsByTagName("li"),j=e.getElementsByTagName("input")[0],a.val=function(c){if("string"!=typeof c)return a.value;if(""!==c||b.required===!1){var d=a.getElementsByTagName("option"),e=a.querySelector('[value="'+c+'"]');e=!!e&&e.innerHTML,d[d.length-1].value=c,a.value=c,i.innerHTML=e||c||b.label_empty,k()}else a.value===a.querySelector("option:last-child").value&&(this.value=a.value)},window.onclick=function(){var a=document.querySelector(".please-define.active");null!==a&&o(a,!1)},e.onclick=function(a){a.stopPropagation();var b=document.querySelectorAll(".please-define.active");for(h=0;h<b.length;h+=1)b[h]!==e&&o(b[h],!1)},i.onclick=function(a){o(e,"toggle")},h=0;h<f.length-1;h+=1)p(f[h]);return j.onkeyup=function(c){var d=this.value,f=c.keyCode||c.which;a.getElementsByTagName("option");if("function"==typeof b.filter&&(d=b.filter(d)||d),this.value=d,13===f)return o(e,!1),a.val(d),!1},a};